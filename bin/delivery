#!/usr/bin/php
<?php

// set_include_path(get_include_path() . PATH_SEPARATOR . '/absolute/path');
require __DIR__.'/../lib/CommandLineRunner.php';

$clr = new cjsDelivery\CommandLineRunner();
$options = getopt($clr->getOptions(), $clr->getLongOptions());
$debugfunc = function($message) {
	echo $message, '...', PHP_EOL;
};

try {
	echo $clr->run($options, $debugfunc), PHP_EOL;
} catch (cjsDelivery\Exception $e) {

	$reporterror = function($e, $reporterror) {
		echo 'Error: ', $e->getMessage(), ' (', $e->getCode(),')', PHP_EOL;
		if ($e->getPrevious()) {
			$reporterror($e->getPrevious(), $reporterror);
		}
	};

	$reporterror($e, $reporterror);
	
	exit(1);
}